type Vault @entity(immutable: false) {
  id: ID!
  vaultId: Bytes!
  controller: Bytes!
  seniorToken: Bytes!
  juniorToken: Bytes!
  vault: Bytes!
  teller: Bytes!
  accountant: Bytes!
  manager: Bytes!
  rateModel: Bytes!
  asset: Bytes!
  paramsHash: Bytes!
  seniorRatePerSecondWad: BigInt!
  maxSeniorRatioBps: BigInt!
  maxRateAge: BigInt!
  paused: Boolean!
  createdAt: BigInt!
  createdAtBlock: BigInt!
  createdTx: Bytes!
  lastSnapshot: TrancheSnapshot
  tvl: BigInt!
  seniorPrice: BigInt!
  juniorPrice: BigInt!
  seniorDebt: BigInt!
  seniorSupply: BigInt!
  juniorSupply: BigInt!
  seniorApyBps: BigInt
  juniorApyBps: BigInt
  updatedAt: BigInt!
  snapshots: [TrancheSnapshot!]! @derivedFrom(field: "vault")
  hourlySnapshots: [VaultHourlySnapshot!]! @derivedFrom(field: "vault")
  dailySnapshots: [VaultDailySnapshot!]! @derivedFrom(field: "vault")
  events: [TrancheEvent!]! @derivedFrom(field: "vault")
}

type RegistryConfig @entity(immutable: false) {
  id: ID!
  registry: Bytes!
  factory: Bytes!
  vaultCount: Int!
  createdAt: BigInt!
  createdAtBlock: BigInt!
  createdTx: Bytes!
  updatedAt: BigInt!
  updatedAtBlock: BigInt!
  updatedTx: Bytes!
}

type TrancheSnapshot @entity(immutable: true) {
  id: ID!
  vault: Vault!
  blockNumber: BigInt!
  timestamp: BigInt!
  txHash: Bytes!
  eventType: String!
  totalValue: BigInt!
  seniorDebt: BigInt!
  seniorSupply: BigInt!
  juniorSupply: BigInt!
  seniorPrice: BigInt!
  juniorPrice: BigInt!
  tvl: BigInt!
  underwater: Boolean!
}

type TrancheEvent @entity(immutable: true) {
  id: ID!
  vault: Vault!
  type: String!
  blockNumber: BigInt!
  timestamp: BigInt!
  txHash: Bytes!
  caller: Bytes
  receiver: Bytes
  assets: BigInt
  shares: BigInt
  seniorDebt: BigInt
  dt: BigInt
  actor: Bytes
  role: Bytes
  sender: Bytes
  oldAddress: Bytes
  newAddress: Bytes
  oldValue: BigInt
  newValue: BigInt
}

type VaultHourlySnapshot @entity(immutable: false) {
  id: ID!
  vault: Vault!
  periodStart: BigInt!
  periodEnd: BigInt!
  updatedAt: BigInt!
  lastTxHash: Bytes!
  txCount: Int!
  eventCount: Int!
  depositCount: Int!
  redeemCount: Int!
  accrualCount: Int!
  seniorDepositAssets: BigInt!
  juniorDepositAssets: BigInt!
  seniorRedeemAssets: BigInt!
  juniorRedeemAssets: BigInt!
  openTvl: BigInt!
  highTvl: BigInt!
  lowTvl: BigInt!
  closeTvl: BigInt!
  openSeniorPrice: BigInt!
  highSeniorPrice: BigInt!
  lowSeniorPrice: BigInt!
  closeSeniorPrice: BigInt!
  openJuniorPrice: BigInt!
  highJuniorPrice: BigInt!
  lowJuniorPrice: BigInt!
  closeJuniorPrice: BigInt!
  tvl: BigInt!
  seniorDebt: BigInt!
  seniorSupply: BigInt!
  juniorSupply: BigInt!
  seniorPrice: BigInt!
  juniorPrice: BigInt!
  underwater: Boolean!
}

type VaultDailySnapshot @entity(immutable: false) {
  id: ID!
  vault: Vault!
  periodStart: BigInt!
  periodEnd: BigInt!
  updatedAt: BigInt!
  lastTxHash: Bytes!
  txCount: Int!
  eventCount: Int!
  depositCount: Int!
  redeemCount: Int!
  accrualCount: Int!
  seniorDepositAssets: BigInt!
  juniorDepositAssets: BigInt!
  seniorRedeemAssets: BigInt!
  juniorRedeemAssets: BigInt!
  openTvl: BigInt!
  highTvl: BigInt!
  lowTvl: BigInt!
  closeTvl: BigInt!
  openSeniorPrice: BigInt!
  highSeniorPrice: BigInt!
  lowSeniorPrice: BigInt!
  closeSeniorPrice: BigInt!
  openJuniorPrice: BigInt!
  highJuniorPrice: BigInt!
  lowJuniorPrice: BigInt!
  closeJuniorPrice: BigInt!
  tvl: BigInt!
  seniorDebt: BigInt!
  seniorSupply: BigInt!
  juniorSupply: BigInt!
  seniorPrice: BigInt!
  juniorPrice: BigInt!
  underwater: Boolean!
}
